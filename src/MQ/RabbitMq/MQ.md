# MQ总结问题

## 1.为什么使用消息队列？
    其实就是问问你消息队列都有哪些使用场景，然后你项目里具体是什么场景，说说你在这个场景里用消息队列是什么？
    面试官问你这个问题，期望的一个回答是说，你们公司有个什么业务场景，这个业务场景有个什么技术挑战，如果不用 MQ 可能会很麻烦，但是你现在用了 MQ 之后带给了你很多的好处。
    1.业务场景(核心场景:解耦,异步,肖峰)
	  2.技术挑战
	  3.如果不用MQ带来的麻烦
	  4.用MQ的好处
## 2.消息队列有什么优点和缺点:
    缺点:1. 系统可用性降低,如何保证消息队列的高可用,镜像集群模式（高可用性）
	 2. 系统复杂度提高,你怎么保证消息没有重复消费？怎么处理消息丢失的情况？怎么保证消息传递的顺序性？头大
		1. 如何保证消息不被重复消费？或者说，如何保证消息消费的幂等性？(消费这条记录记录在另外一个地方,在消费查是否是重复的)
			1.唯一id+指纹码
			2.redis的原子性
		2. 如何保证消息的可靠性传输？或者说，如何处理消息丢失的问题？
		        1.生产者:防止数据丢失采用  confirm 机制的
			2.RabbitMQ 弄丢了数据:开启 RabbitMQ 的持久化
		3. 消费端弄丢了数据:ack 机制
	3. 一致性问题,
	4. 顺序性:
		rabbitmq：***拆分多个queue，每个queue一个consumer，
		就是多一些queue而已，确实是麻烦点；或者就一个queue但是对应一个consumer，
		然后这个consumer内部用内存队列做排队，然后分发给底层不同的worker来处理
## 3.如何保证消息队列的高可用:
这个问题这么问是很好的，因为不能问你 Kafka 的高可用性怎么保证？ActiveMQ 的高可用性怎么保证？一个面试官要是这么问就显得很没水平，人家可能用的就是 RabbitMQ，没用过 Kafka，你上来问人家 Kafka 干什么？这不是摆明了刁难人么。

所以有水平的面试官，问的是 MQ 的高可用性怎么保证？这样就是你用过哪个 MQ，你就说说你对那个 MQ 的高可用性的理解。

## RabbitMQ的高可用
1.镜像集群模式(高可用)
这种模式，才是所谓的 RabbitMQ 的高可用模式。跟普通集群模式不一样的是，在镜像集群模式下，你创建的 queue，无论元数据还是 queue 里的消息都会存在于多个实例上，就是说，每个 RabbitMQ 节点都有这个 queue 的一个完整镜像，包含 queue 的全部数据的意思。然后每次你写消息到 queue 的时候，都会自动把消息同步到多个实例的 queue 上。

![img](https://github.com/longchenwen/mainshi/blob/master/src/MQ/RabbitMq/rabbirmq%E9%AB%98%E5%8F%AF%E7%94%A8.png)

那么如何开启这个镜像集群模式呢？其实很简单，RabbitMQ 有很好的管理控制台，就是在后台新增一个策略，这个策略是镜像集群模式的策略，指定的时候是可以要求数据同步到所有节点的，也可以要求同步到指定数量的节点，再次创建 queue 的时候，应用这个策略，就会自动将数据同步到其他的节点上去了。

这样的话，好处在于，你任何一个机器宕机了，没事儿，其它机器（节点）还包含了这个 queue 的完整数据，别的 consumer 都可以到其它节点上去消费数据。坏处在于，第一，这个性能开销也太大了吧，消息需要同步到所有机器上，导致网络带宽压力和消耗很重！第二，这么玩儿，不是分布式的，就没有扩展性可言了，如果某个 queue 负载很重，你加机器，新增的机器也包含了这个 queue 的所有数据，并没有办法线性扩展你的 queue。你想，如果这个 queue 的数据量很大，大到这个机器上的容量无法容纳了，此时该怎么办呢？

	
## 如何解决消息队列的延时以及过期失效问题(几乎不设置过期时间)?
## 消息队列满了以后该怎么处理？有几百万消息持续积压几小时，说说怎么解决？(增加消费者,queue)
 
